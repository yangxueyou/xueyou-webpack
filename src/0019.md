### 简介

让webpack能够识别并打包vue组件

具备 hmr 功能

https://webpack.docschina.org/guides/hot-module-replacement/#other-code-and-frameworks


### 安装使用

https://www.npmjs.com/package/vue-loader

16 版本之前是 vue2

16 之后 vue3

```js
$ npm i -S vue // vue 2.6
$ npm i -D vue-template-compiler // 2.x
$ npm i -D vue-loader@14  // 因为我们的vue是2，所以要限制一下版本，16以下，14的版本自动就带 hmr
$ npm i -D vue-loader@15  // 因为我们的vue是2，所以要限制一下版本，16以下，需要自己实现 vue-loader/lib/plugin
```

```vue
<template>
  <div class="example">{{ msg }}</div>
</template>

<script>
export default {
  data () {
    return {
      msg: 'Hello world!'
    }
  }
}
</script>

<style>
.example {
  color: red;
}
</style>
```

```js
// index.js
import Vue from 'vue';
import App from './app';

new Vue({
  render: h => h(App)
}).$mount('#app')
```


```js
// webpack.config.js
const path = require("path");
const { DefinePlugin } = require("webpack"); // 暴露全局常量
const { CleanWebpackPlugin } = reuqire("clean-webpack-plugin"); // 清空打包目录
const HtmlWebpackPlugin = require("html-webpack-plugin"); // 自动生成html
const CopyWebpackPlugin = require("copy-webpack-plugin"); // 把 public 目录文件复制到 dist 下面
const ReactRefreshWebpackPlugin = require("@pmmmwh/react-refresh-webpack-plugin");  // react 自动刷新用，需要配合 react-refresh
const vueLoaderPlugin = require('vue-loader/lib/plugin')  // vue14之后需要使用

module.exports = {
  // watch: true,  // 默认是 false
  mode: "development",
  devtool: false, // 打包出的内容就不是 eval() ，正常结构了
  entry: "./src/index.js",
  output: {
    filename: "js/build.js", // 打包结果的文件名称，并且到 dist/js 目录
    path: path.resolve(__dirname, "dist"), // 路径，只能是绝对路径
    // assetModuleFilename: "img/[name].[hash:4][ext]", // asset模块使用，这是全局配置，可能字体也使用 asset 模块
  },
  target: "web", // 开发阶段屏蔽掉，如果不写这个，热更新不生效，mode模式和.browserslistrc导致的
  devServer: {
    hot: true, // 这就相当于实现了热更新
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          "style-loader",
          {
            loader: "css-loader",
            options: {
              importLoaders: 1, // css-loader处理过程中，发现有其它css文件时，向前找一个loader（postcss-loader），如果想找更多的就增加数字
              esModule: false, // 否则加载背景图片失败
            },
          },
          "postcss-loader",
        ], // 执行顺序是从后向前
      }, // 另一种简写形式，有多个loader，并且不需要配置参数
      {
        test: /\.less$/,
        // 因为配置文件提取到了 postcss.config.js 中（0005.md），所以 "postcss-loader" 直接写在这就可以了
        use: ["style-loader", "css-loader", "postcss-loader", "less-loader"], // 执行顺序是从后向前
      },
      {
        test: /\.(png|svg|gif|jpe?g)$/, // 使用 webpack5 内置模块
        type: "asset", // 根据条件判断使用哪种模式
        generator: {
          filename: "img/[name].[hash:4][ext]",
        },
        parser: {
          dataUrlCondition: {
            maxSize: 30 * 1024, // 大于 30kb 进行拷贝，否则直接打包进代码里
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/, // iconfront 图标字体
        type: "asset/resource", // 直接作为静态资源拷贝出去就可以了
        generator: {
          filename: "font/[name].[hash:4][ext]",
        },
      },
      {
        // test: /\.js$/,
        // exclude: /node_modules/,
        // use: ["babel-loader"] // 使用 babel.config.js 配置文件
        // use: [
        //   {
        //     loader: "babel-loader",
        //     options: {
        //       // plugins: [
        //       //   '@babel/plugin-transform-arrow-functions',
        //       //   '@babel/plugin-transform-block-scoping'
        //       // ]
        //       // presets: ['@babel/preset-env']  // 是否转换取决于什么条件？.browserslistrc 配置文件，建议使用这种形式
        //       presets: [
        //         [
        //           "@babel/preset-env",
        //           {
        //             targets: "chrome 91",
        //           },
        //         ],
        //       ], // 是否转换取决于什么条件？当前的targets
        //     },
        //   },
        // ],
      },
      {
        test: /\.jsx?$/,
        exclude: /node_modules/,
        use: ["babel-loader"],
      },
            {
        test: /\.vue$/,
        exclude: /node_modules/,
        use: ["vue-loader"],
      },
    ],
  },

  plugins: [
    new CleanWebpackPlugin(),
    new HtmlWebpackPlugin({
      title: "test title",
      template: "./public/index.html",
    }),
    new DefinePlugin({
      BASE_URL: '"./"', // 如果只有一个引号，解析出去的就是 ./ ，这样解析的是字符串 './'
    }),
    new CopyWebpackPlugin({
      patterns: [
        {
          from: "public",
          // to: // 如果不写这个默认就会找我们设置的 output，正常不写，比较方便，否则这个名称需要和output一样
          globOptions: {
            ignore: ["**/index.html"], // 把public下面的index.html排除掉，否者跟上面的HtmlWebpackPlugin，CleanWebpackPlugin重复操作了
          },
        },
      ],
    }),
    new ReactRefreshWebpackPlugin(), // 只这个组件，react 并不能热更新，还需要使用 react-refresh
    new vueLoaderPlugin(),    // vue-loader 14 版本之后需要使用
  ],
};
```