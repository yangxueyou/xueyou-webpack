### 快速上手

```js
$ npm i -D html-webpack-plugin
```

```js
// webpack.config.js
const path = require("path");
const { DefinePlugin } = require("webpack"); // 暴露全局常量
const { CleanWebpackPlugin } = reuqire("clean-webpack-plugin"); // 清空打包目录
const HtmlWebpackPlugin = require("html-webpack-plugin"); // 自动生成html

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "build.js", // 打包结果的文件名称
    path: path.resolve(__dirname, "dist"), // 路径，只能是绝对路径
    // assetModuleFilename: "img/[name].[hash:4][ext]", // asset模块使用，这是全局配置，可能字体也使用 asset 模块
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          "style-loader",
          {
            loader: "css-loader",
            options: {
              importLoaders: 1, // css-loader处理过程中，发现有其它css文件时，向前找一个loader（postcss-loader），如果想找更多的就增加数字
              esModule: false, // 否则加载背景图片失败
            },
          },
          "postcss-loader",
        ], // 执行顺序是从后向前
      }, // 另一种简写形式，有多个loader，并且不需要配置参数
      {
        test: /\.less$/,
        // 因为配置文件提取到了 postcss.config.js 中（0005.md），所以 "postcss-loader" 直接写在这就可以了
        use: ["style-loader", "css-loader", "postcss-loader", "less-loader"], // 执行顺序是从后向前
      },
      {
        test: /\.(png|svg|gif|jpe?g)$/, // 使用 webpack5 内置模块
        type: "asset", // 根据条件判断使用哪种模式
        generator: {
          filename: "img/[name].[hash:4][ext]",
        },
        parser: {
          dataUrlCondition: {
            maxSize: 30 * 1024, // 大于 30kb 进行拷贝，否则直接打包进代码里
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/, // iconfront 图标字体
        type: "asset/resource", // 直接作为静态资源拷贝出去就可以了
        generator: {
          filename: "font/[name].[hash:4][ext]",
        },
      },
    ],
  },

  plugins: [
    new CleanWebpackPlugin(),
    new HtmlWebpackPlugin({
      title: "test title",
      template: "./public/index.html",
    }),
    new DefinePlugin({
      BASE_URL: '"./"', // 如果只有一个引号，解析出去的就是 ./ ，这样解析的是字符串 './'
    }),
  ],
};
```

```html
<!--  public 静态资源，一般情况不会打包，直接拷贝到dist目录下，最后把dist当作静态资源，部署到服务器上  -->
<!-- public/index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- 网站的icon图片 -->
    <!-- BASE_URL 因为是全部大写，推测是一个常量，需要webpack暴露到全局的一个常量 -->
    <link ref="icon" href="<%= BASE_URL %>favicon.io" />
    <title>
      <!-- 这个是站位用，到时候webpack打包会被替换 title 的 value --> <!--
      这是一个 ejs 模版语法，vue的也是 --> <%= o.htmlWebpackPlugin.options.title
      %>
    </title>
  </head>
  <body>
    <!-- 快速生成  div#app -->
    <div id="app">test</div>
  </body>
</html>
```

### html-webpack-plugin

该插件将为你生成一个 HTML5 文件， 其中包括使用 script 标签的 body 中的所有 webpack 包。

配合`mini-css-extract-plugin`一起使用

### 基本用法

```js
var HtmlWebpackPlugin = require("html-webpack-plugin");
var path = require("path");

module.exports = {
  entry: "index.js",
  output: {
    path: path.resolve(__dirname, "./dist"),
    filename: "index_bundle.js",
  },
  plugins: [new HtmlWebpackPlugin()],
};
```

这将会产生一个包含以下内容的文件 dist/index.html：

```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>webpack App</title>
  </head>
  <body>
    <script src="index_bundle.js"></script>
  </body>
</html>
```

### options

https://www.cnblogs.com/wonyun/p/6030090.html

```js
this.options = _.extend(
  {
    template: path.join(__dirname, "default_index.ejs"),
    filename: "index.html",
    hash: false,
    inject: true,
    compile: true,
    favicon: false,
    minify: false,
    cache: true,
    showErrors: true,
    chunks: "all",
    excludeChunks: [],
    title: "Webpack App",
    xhtml: false,
  },
  options
);
```

- `title:` 生成的 html 文档的标题。配置该项，它并不会替换指定模板文件中的 title 元素的内容，除非 html 模板文件中使用了模板引擎语法来获取该配置项值，如下 ejs 模板语法形式：

```js
<title>{%= o.htmlWebpackPlugin.options.title %}</title>
```

- `filename：`输出文件的文件名称，默认为 index.html，不配置就是该文件名；此外，还可以为输出文件指定目录位置（例如'html/index.html'）

  - filename 配置的 html 文件目录是相对于 webpackConfig.output.path 路径而言的，不是相对于当前项目目录结构的。
  - 指定生成的 html 文件内容中的 link 和 script 路径是相对于生成目录下的，写路径的时候请写生成目录下的相对路径。

- `template:` 本地模板文件的位置，支持加载器(如 handlebars、ejs、undersore、html 等)，如比如 handlebars!src/index.hbs；
  - template 配置项在 html 文件使用 file-loader 时，其所指定的位置找不到，导致生成的 html 文件内容不是期望的内容。
  - 为 template 指定的模板文件没有指定任何 loader 的话，默认使用 ejs-loader。如 template: './index.html'，若没有为.html 指定任何 loader 就使用 ejs-loader

### mini-css-extract-plugin

```js
const MiniCssExtractPlugin = require("mini-css-extract-plugin");

module.exports = {
  module: {
    rules: [
      {
        test: /\.(sa|sc|c)ss$/,
        use: [
          {
            loader: MiniCssExtractPlugin.loader,
            options: {
              hmr: !isProduction,
            },
          },
          "css-loader",
          {
            loader: "postcss-loader",
            options: {
              plugins: (loader) => [
                require("autoprefixer")({
                  overrideBrowserslist: [
                    "Android 4.1",
                    "iOS 7.1",
                    "Chrome > 31",
                    "ff > 31",
                    "ie >= 8",
                  ],
                }),
                require("cssnano"),
              ],
            },
          },
          "sass-loader",
        ],
      },
    ],
  },
};
```

### 参考

https://v4.webpack.docschina.org/plugins/html-webpack-plugin/

https://github.com/jantimon/html-webpack-plugin#options
