### 简介

让 webpack 将图片也当作一个模块对待，然后执行打包操作

打包图片：

- img src
  - 使用 require 导入图片，并且不配置 esModule: false，则需 .default 导出
  - 也可以配置 esModule: false
  - 采用 import xxx from 图片资源，此时可以直接使用
- background url

```js
import imgSrc from "./img/test.png";

function packImg() {
  // 01 创建一个容器元素
  const oELe = document.createElement("div");

  // 02 创建 img 标签，设置 src 属性
  const oImg = document.createElement("img"); // 通过 new 命令也可以创建
  oImg.width = 400;
  // oImg.src = require('./img/test.png').default; // webpack4 不需要default，5需要
  // oImg.src = require('./img/test.png').default; // 不写 default，需要在file-loader里面配置options
  oImg.src = imgSrc; // 这样写 file-loader 也是简写，导入写在上面，也不需要写 default
  oEle.appendChild(oImg);

  // 03 设置背景图片
  const oBgImg = document.createElement("div");
  oBgImg.className = "bgBox";
  oEle.appendChild(oBgImg);

  return oEle;
}

document.body.appendChild(packImg());
```

```css
.bgBox {
  width: 200px;
  height: 200px;
  background-image: url("./test/test.png");
}
```

### 功能

1. 当我们把图片当一个模块导入的时候，返回一个 js 能识别的东西
2. 把要处理的二进制资源（binary）去拷贝一份到指定的目录，默认是 dist 目录下面去

```js
$ npm i -D file-loader
```

```js
// webpack.config.js
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "build.js", // 打包结果的文件名称
    path: path.resolve(__dirname, "dist"), // 路径，只能是绝对路径
  },
  module: {
    rules: [
      // {
      //   test: /\.css$/, // 一般就是一个正则表达式，用于匹配要处理的文件类型, \是转移， $表示结尾
      //   use: [
      //     {
      //       loader: "css-loader", // 表示要用的loader
      //       // options: // 字符串或着对象，可选参数，用户传进来特定的配置参数
      //       // query: // webpack5 里已经合并到options里面了
      //     },
      //   ],
      // },
      // {
      //   test: /\.css$/,
      //   loader: 'css-loader'
      // },    // 上面的简写，只有一个loader，且没有什么配置参数，完全可以简写
      {
        test: /\.css$/,
        use: [
          "style-loader",
          {
            loader: "css-loader",
            options: {
              importLoaders: 1, // css-loader处理过程中，发现有其它css文件时，向前找一个loader（postcss-loader），如果想找更多的就增加数字
              esModule: false, // 否则加载背景图片失败
            },
          },
          "postcss-loader",
        ], // 执行顺序是从后向前
      }, // 另一种简写形式，有多个loader，并且不需要配置参数
      {
        test: /\.less$/,
        // 因为配置文件提取到了 postcss.config.js 中（0005.md），所以 "postcss-loader" 直接写在这就可以了
        use: ["style-loader", "css-loader", "postcss-loader", "less-loader"], // 执行顺序是从后向前
      },
      {
        test: /\.(png|svg|gif|jpe?g)$/, // 小括号中间表示 或 的关系，？表示 e 可有可无
        user: ["file-loader"],
        // user: [{
        //   loader: "file-loader",
        //   options: {
        //     esModule: false   // 不转为esModule
        //   }
        // }]
      },
    ],
  },
};
```

### 设置图片名称与输出

默认情况图片的名字是 md4 的 哈希值

```js
// webpack.config.js
const path = require("path");

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "build.js", // 打包结果的文件名称
    path: path.resolve(__dirname, "dist"), // 路径，只能是绝对路径
  },
  module: {
    rules: [
      // {
      //   test: /\.css$/, // 一般就是一个正则表达式，用于匹配要处理的文件类型, \是转移， $表示结尾
      //   use: [
      //     {
      //       loader: "css-loader", // 表示要用的loader
      //       // options: // 字符串或着对象，可选参数，用户传进来特定的配置参数
      //       // query: // webpack5 里已经合并到options里面了
      //     },
      //   ],
      // },
      // {
      //   test: /\.css$/,
      //   loader: 'css-loader'
      // },    // 上面的简写，只有一个loader，且没有什么配置参数，完全可以简写
      {
        test: /\.css$/,
        use: [
          "style-loader",
          {
            loader: "css-loader",
            options: {
              importLoaders: 1, // css-loader处理过程中，发现有其它css文件时，向前找一个loader（postcss-loader），如果想找更多的就增加数字
              esModule: false, // 否则加载背景图片失败
            },
          },
          "postcss-loader",
        ], // 执行顺序是从后向前
      }, // 另一种简写形式，有多个loader，并且不需要配置参数
      {
        test: /\.less$/,
        // 因为配置文件提取到了 postcss.config.js 中（0005.md），所以 "postcss-loader" 直接写在这就可以了
        use: ["style-loader", "css-loader", "postcss-loader", "less-loader"], // 执行顺序是从后向前
      },
      {
        test: /\.(png|svg|gif|jpe?g)$/, // 小括号中间表示 或 的关系，？表示 e 可有可无
        user: [
          {
            loader: "file-loader",
            /**
             * 常见的占位符
             *
             * 打包前后一样
             *
             * [ext]: 扩展名，文件的后缀
             * [name]: 文件名称
             * [hash]: 结合文件内容生成一个哈希值
             * [contentHash]: 和 hash 一样，在其它地方可能不一样
             * [hash:<length>]: hash 生成的文件名太长了，自己选择一个长度
             * [path]: 文件路径，webpack中不常用
             */
            // options: {
            //   name: '[name].[hash:6].[ext]',  // 打包图片的名称
            //   outputPath: 'img'   // 输出到 dist/img 目录里
            // }
            options: {
              name: "img/[name].[hash:6].[ext]", // 上面的简写
            },
          },
        ],
      },
    ],
  },
};
```
