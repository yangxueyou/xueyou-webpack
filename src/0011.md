### 介绍

在 webpack 打包过程中，插件是必不可少的环节


### 插件 vs loader

- loader：对`特定类型`进行`转换`，执行时间：当我们要去`读取特定类型`的时候开始工作

- plugin：可以做更多的事情

webpack 打包过程跟 vue、react 一样有自己的`生命周期`，可以认为整个打包过程就是一个完整的流水线，插件可以在这个流水线的任意时机被插进来

比如：我们想在打包开始的时候做一些事情，打包中要做一些事情，要写入磁盘上之前做一些事情，这些操作用`loader`就不行了


### 快速上手

先通过一个自动清除打包后目录的插件，熟悉一下使用情况

```js
$ npm i -D clean-webpack-plugin
```

```js
// webpack.config.js
const path = require("path");
const { CleanWebpackPlugin } = reuqire("clean-webpack-plugin");

module.exports = {
  entry: "./src/index.js",
  output: {
    filename: "build.js", // 打包结果的文件名称
    path: path.resolve(__dirname, "dist"), // 路径，只能是绝对路径
    // assetModuleFilename: "img/[name].[hash:4][ext]", // asset模块使用，这是全局配置，可能字体也使用 asset 模块
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          "style-loader",
          {
            loader: "css-loader",
            options: {
              importLoaders: 1, // css-loader处理过程中，发现有其它css文件时，向前找一个loader（postcss-loader），如果想找更多的就增加数字
              esModule: false, // 否则加载背景图片失败
            },
          },
          "postcss-loader",
        ], // 执行顺序是从后向前
      }, // 另一种简写形式，有多个loader，并且不需要配置参数
      {
        test: /\.less$/,
        // 因为配置文件提取到了 postcss.config.js 中（0005.md），所以 "postcss-loader" 直接写在这就可以了
        use: ["style-loader", "css-loader", "postcss-loader", "less-loader"], // 执行顺序是从后向前
      },
      {
        test: /\.(png|svg|gif|jpe?g)$/, // 使用 webpack5 内置模块
        type: "asset", // 根据条件判断使用哪种模式
        generator: {
          filename: "img/[name].[hash:4][ext]",
        },
        parser: {
          dataUrlCondition: {
            maxSize: 30 * 1024, // 大于 30kb 进行拷贝，否则直接打包进代码里
          },
        },
      },
      {
        test: /\.(ttf|woff2?)$/,  // iconfront 图标字体
        type: "asset/resource", // 直接作为静态资源拷贝出去就可以了
        generator: {
          filename: "font/[name].[hash:4][ext]",
        },
      },
    ],
  },

  plugins: [
    new CleanWebpackPlugin(),
  ]
};
```


```js
// 插件就是一个 class
class Myplugin {
  constructor() {
    apply() // apply 执行的时候就可以接受相应的参数了，把 this 等等都传递过去，整个插件就能工作了
  }
}
```